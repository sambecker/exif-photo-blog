/* eslint-disable max-len */

export type AiAutoGeneratedField =
  'title' |
  'caption' |
  'tags' |
  'semantic'

export const ALL_AI_AUTO_GENERATED_FIELDS: AiAutoGeneratedField[] = [
  'title',
  'caption',
  'tags',
  'semantic',
];

export const parseAiAutoGeneratedFieldsText = (
  text = 'all',
): AiAutoGeneratedField[] => {
  const textFormatted = text.trim().toLocaleLowerCase();
  if (textFormatted === 'none') {
    return [];
  } else if (textFormatted === 'all') {
    return ALL_AI_AUTO_GENERATED_FIELDS;
  } else {
    const fields = textFormatted
      .toLocaleLowerCase()
      .split(',')
      .map(field => field.trim())
      .filter(field => ALL_AI_AUTO_GENERATED_FIELDS
        .includes(field as AiAutoGeneratedField));
    return fields as AiAutoGeneratedField[];
  }
};

export type AiImageQuery =
  'title' |
  'caption' |
  'title-and-caption' |
  'tags' |
  'description-small' |
  'description' |
  'description-large' |
  'description-semantic';

export const PHOTO_GENRES = ['portrait photography', 'landscape photography', 'animal photography', 'street photography', 'event photography'] as const;
export type PhotoGenre = typeof PHOTO_GENRES[number];

// Fixed mapping of genres to their Chinese translations
export const GENRE_TRANSLATIONS: Record<PhotoGenre, string> = {
  'portrait photography': '人像摄影',
  'landscape photography': '风光摄影',
  'animal photography': '动物摄影',
  'street photography': '街拍摄影',
  'event photography': '活动摄影',
};

export const AI_IMAGE_QUERIES: Record<AiImageQuery, string> = {
  'title': 'You are a creative bilingual photography curator with an eye for authenticity. Create a fresh, meaningful title in both English and Chinese that captures the true essence of this moment. IMPORTANT: Avoid both clichéd poetic words (like "echoes", "whispers", "dreams", "soul") AND technical/scientific terms. Instead, focus on: the genuine mood, the distinct atmosphere, key visual elements, or the story suggested by the scene. Draw inspiration from the actual feeling, time, place, or natural elements present. Format: "English Title | 中文标题". Keep each title within 5-6 words. Each title should feel authentic to the specific image - if it could apply to any photo, start over. Do not describe or identify any people.',
  'caption': 'As a photography curator with an eye for authenticity, craft a bilingual caption that reveals the true character of this scene. Focus on the distinctive visual qualities that make this moment special - the interplay of light, the mood of the colors, the texture of the environment, or the atmosphere of the moment. Avoid technical jargon and clichéd descriptions. Format: "English Caption | 中文说明". Keep each caption within 10 words but make them meaningful. If the caption could describe any similar photo, start over. Do not describe or identify any people.',
  'title-and-caption': 'You are a creative bilingual photography curator who values authenticity. First, create a meaningful title that avoids both clichés (no "echoes", "whispers", "dreams", "soul") and technical jargon. Focus on the genuine mood, atmosphere, and key elements that make this image unique. Draw from the actual feeling, time, place, or natural elements present. Then write a complementary caption that deepens this authentic perspective. Format: Title: "English Title | 中文标题" Caption: "English Caption | 中文说明". Keep titles within 5-6 words and captions within 8 words. If either could apply to any photo, start over. Do not describe or identify any people.',
  'tags': `First, identify which ONE genre best describes this image from ONLY these options: portrait photography (人像摄影), landscape photography (风光摄影), animal photography (动物摄影), street photography (街拍摄影), event photography (活动摄影).

Then generate exactly 10 tags following this strict structure for both English and Chinese. IMPORTANT: Generate ONLY the tags - do not include any messages about people identification or any other explanatory text.

English tags (first 5):
1. The genre you identified above
2. ONE mood from ONLY these options: serene, dramatic, intimate, nostalgic, ethereal, dynamic, contemplative, minimalist, mysterious, melancholic, peaceful, vibrant, dreamy, solemn, whimsical, tranquil, bold, tender, moody, graceful
3. ONE lighting from ONLY these options: golden hour, harsh light, soft light, backlit, low key, high key, natural light, artificial light, dappled light, rim light, twilight, overcast, directional, diffused, shadow play, window light, ambient, dramatic light, silhouette, mixed lighting
4. ONE scene type from ONLY these options: urban scene, natural vista, interior space, street scene, waterfront, architecture, rural life, abstract, cityscape, mountain view, coastal scene, forest scene, industrial, park life, suburban, night scene, desert scene, garden view, historic site, modern space
5. ONE composition focus from ONLY these options: leading lines, negative space, geometric shapes, framing, layers, color harmony, shadows, details, symmetry, rule of thirds, diagonal lines, minimalism, texture, patterns, reflections, depth of field, contrast, curves, perspective, repetition

Chinese tags (next 5):
1. The genre's Chinese translation as provided above
2. Mood translation: 宁静, 戏剧性, 私密, 怀旧, 空灵, 动感, 沉思, 极简, 神秘, 忧郁, 平和, 鲜活, 梦幻, 庄重, 异想, 恬静, 大胆, 温柔, 氛围, 优雅
3. Lighting translation: 黄金光, 强光, 柔光, 逆光, 低调, 高调, 自然光, 人工光, 斑驳光, 边缘光, 暮光, 阴天, 定向光, 漫射光, 光影, 窗光, 环境光, 戏剧光, 剪影, 混合光
4. Scene translation: 都市, 自然景观, 室内, 街景, 滨水, 建筑, 乡村, 抽象, 城市全景, 山景, 海景, 林景, 工业, 公园, 郊区, 夜景, 沙漠, 园景, 古迹, 现代
5. Composition translation: 引导线, 留白, 几何, 构图, 层次, 色彩, 阴影, 细节, 对称, 三分法, 斜线, 简约, 质地, 图案, 倒影, 景深, 对比, 曲线, 透视, 重复

Format your response as a simple comma-separated list. Do not include any additional text or messages. Example: "landscape photography, serene, natural light, natural vista, leading lines, 风光摄影, 宁静, 自然光, 自然景观, 引导线"`,
  'description-small': 'Write a concise yet vivid description focusing on the key visual elements, mood, and atmosphere. Start directly with active, descriptive language. Focus on what makes this image unique or striking. Avoid generic phrases like "This image shows" or "This is a picture of".',
  'description': 'Write a balanced description that covers composition, lighting, mood, and subject matter. Include notable technical aspects like depth of field, color palette, or framing. Describe the overall visual impact and any interesting details that contribute to the image\'s story.',
  'description-large': 'Provide a comprehensive analysis of the image covering: 1) Technical aspects (composition, lighting, color, focus), 2) Subject matter and visual elements, 3) Mood and atmosphere, 4) Artistic choices and their impact, 5) Notable details and their contribution to the overall image. Use specific photography terminology where relevant.',
  'description-semantic': 'List exactly 5 key elements or subjects in this image as a comma-separated list. Focus on concrete, visually distinct elements that define the scene. List them in order of visual prominence. Be specific but concise, using precise nouns without additional description.',
};

export const parseTitleAndCaption = (text: string) => {
  const matches = text.includes('Title')
    ? text.match(/^[`'"]*Title: ["']*(.*?)["']*[ ]*Caption: ["']*(.*?)\.*["']*[`'"]*$/)
    : text.match(/^(.*?): (.*?)$/);

  return {
    title: matches?.[1]?.trim() ?? '',
    caption: matches?.[2]?.trim() ?? '',
  };
};

export const parseBilingualTags = (text: string): string[] => {
  return text.split(',').map(t => t.trim());
};

export const cleanUpAiTextResponse = (text: string) =>
  text
    .replaceAll('\n', ' ')
    .replaceAll('"', '')
    .replace(/\.$/, '');
